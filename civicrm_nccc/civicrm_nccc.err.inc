<?php
function civicrm_nccc_err($response_code = NULL){
  if($response_code){
    $msg = $_GET['msg'];
  }
  else{
    $msg = t('Unknown error');
  }
  $items = array(
    '錯誤代碼：'.$response_code,
    '錯誤訊息：'.$msg,
  );
  $output = '很抱歉，您的信用卡刷卡不成功，錯誤訊息可參考下方資訊：';
  $output .= theme('item_list', $items);
  $output .= '若有疑問，可與我們聯絡，提供錯誤訊息以協助處理';
  if(!empty($_SESSION['nccc']['path'])){
    $output .= '，或您可以'.l('再試一次', $_SESSION['nccc']['path'], array('query' => $_SESSION['nccc']['query']));
    unset($_SESSION['nccc']);
  }
  $output .= '，謝謝。';
  return $output;
}

function _civicrm_nccc_err(){
  $err = array();
  $err['responsecode'] = array(
    "901" => "特店代號格式錯誤",
    "902" => "端末機代號格式錯誤",
    "903" => "訂單編號格式錯誤",
    "904" => "交易金額格式錯誤",
    "905" => "回應網址格式錯誤",
    "906" => "分期交易,請輸入分期期數",
    "907" => "交易模式輸入錯誤!! '0':一般交易 '1':分期交易 '2':紅利折抵交易",
    "908" => "特店代號：不存在",
    "909" => "此特店代號已解約",
    "910" => "貴店網址與本中心註冊網址不同,請查明後再使用，謝謝",
    "911" => "訂單編號重複",
    "912" => "端末機代號：不存在",
    "913" => "端末機代號已停用",
    "914" => "資料庫 AUTH_RECORD 新增失敗",
    "915" => "資料庫 AUTH_RECORD 讀取失敗",
    "916" => "連接授權主機失敗",
    "917" => "HPPRequest 不支援此呼叫方法(僅支援 GET/POST) ",
    "918" => "交易逾時 [Session 資料不一致] ",
    "919" => "交易逾時 [Session=null] ",
    "920" => "卡號錯誤",
    "922" => "3D交易認證錯誤",
    "923" => "卡片效期格式錯誤",
    "924" => "端末機不支援 HPP 功能",
    "926" => "端末機不支援此功能",
    "929" => "端末機尚未建檔",
    "930" => "特店回覆 Plug=In 資料檢核錯誤",
    "931" => "交易失敗",
    "932" => "1.OrderID 為 EC 系統交易序號對應商店指派的「交易訂單編號」。2.當商店執行 HPP Plug-In 時，Hosted Pay Page 會偵測該編號是否為唯一(未執行過 HPP Plug-In)，當偵測到同一編號重覆執行 Plug-In 時，系統回覆「932-訂單編號重複執行 Plug-In」之錯誤訊息。",
    "933" => "訂單編號不存",
    "934" => "發卡行 3D 認證數字簽章驗 失敗",
    "935" => "發卡行 3D 認證主機回覆認證錯誤",
    "936" => "超過特店月限額",
    "937" => "單筆交易金額不能超過 10 萬元",
    "938" => "銀行別錯誤",
    "589" => "Blocked BIN ",
    "998" => "轉交發卡行進 3D 認證",
    "999" => "系統",
  );

  $err['bank_success'] = array(
    '授權交易成功' => '[00][08][11]',
  );

  $err['bank_error'] = array(
    '請與發卡銀行聯絡 (Call Bank)' => '[01][02][P1][P4][P6][P9][T4]',
    '拒絕交易 (Decline)' => '[03][05][06][09][12-15][30-31][39][51][55-58][61-63][65][68][75-92][94][N1-N9][O0-O9][P0][P2][P3][P5][P7][P8][Q0-Q4][Q6-Q9][R0-R8][S4][S5][S6][S7][S8][S9][T5][A3][A9]',
    '沒收卡片 (Pickup)' => '[04][07][34-38][41][43][Q5]',
    '卡片過期' => '[33][54]',
    '交易日期錯誤' => '[T2]',
    '交易逾時(發卡行之授權訊息無法於規定之時間內(25秒)回覆至授權主機)' => '[AY]',
    '風險卡號或分期紅利資料讀取失敗' => '[A9]',
    '分期資料錯誤' => '[AD][AE]',
    '紅利資料錯誤' => '[AI]',
    '不支援分期交易' => '[AH][AG]',
    '不支援紅利交易' => '[AK][AL]',
  );
}
